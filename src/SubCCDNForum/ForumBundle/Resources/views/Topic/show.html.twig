{% extends 'CCDNForumForumBundle::base.html.twig' %}

{% set LayoutTemplate = ccdn_forum_forum.topic.show.layout_template %}

{% block title %}{{- truncDot('title.topic.show' | trans({'%topic_title%': topic.getTitle |capitalize}, 'CCDNForumForumBundle'), ccdn_forum_forum.seo.title_length) -}}{% endblock %}

{%- block body_content -%}

    {%- spaceless -%}

	<header class="row-fluid">
		<div class="span6">
		    <h3 title="{{- topic.getTitle -}}">{{- truncDot(topic.getTitle |capitalize, 70) -}}</h3>
		</div>
		<div class="span6 content-right">
		    <span class="label label-inverse prominent-figure" title="{{- topic.cachedReplyCount -}}">
				{{- 'topic.count.replies' |trans({}, 'CCDNForumForumBundle') -}}
				{{- abbr_number(topic.cachedReplyCount) -}}
			</span>

		    <span class="label label-inverse prominent-figure" title="{{- topic.cachedViewCount -}}">
				{{- 'topic.count.views' |trans({}, 'CCDNForumForumBundle') -}}
				{{- abbr_number(topic.cachedViewCount) -}}
			</span>

		    {%- if subscription_count is defined -%}
		        <span class="label label-inverse prominent-figure" title="{{- subscription_count -}}">
					{{- 'topic.count.subscriptions' |trans({}, 'CCDNForumForumBundle') -}}
					{{- abbr_number(subscription_count) -}}
				</span>
		    {%- endif -%}
		</div>
	</header>


	{%- if topic.isDeleted or topic.isClosed or topic.isSticky -%}
		<section class="row-fluid">
			<div class="span12">
				{%- if topic.isDeleted or topic.isClosed %}
			        <div class="alert alert-error block-alert">	
					    {%- if topic.isDeleted -%}
				            <i class="icon-trash"></i>
				            {% set topic_deleter = create_profile(topic.getDeletedBy) %}

				            {{- 'generic.deleted_by' | trans({'%name%': topic_deleter.getProfilePath}, 'CCDNForumForumBundle') |raw -}}

							&nbsp;&#183;

				            {{- topic.getDeletedDate |date(ccdn_forum_forum.topic.show.topic_deleted_datetime_format) -}}
					    {%- endif -%}

					    {%- if topic.isClosed -%}
							{%- if topic.isDeleted -%}<br>{%- endif -%}
				            <i class="icon-lock"></i>
				            {% set topic_closer = create_profile(topic.getClosedBy) %}

				            {{- 'topic.closed_by' | trans({'%name%': topic_closer.getProfilePath}, 'CCDNForumForumBundle') |raw -}}

							&nbsp;&#183;

				            {{- topic.getClosedDate |date(ccdn_forum_forum.topic.show.topic_closed_datetime_format) -}}
					    {%- endif -%}
			        </div>
				{%- endif -%}
			
			    {%- if topic.isSticky -%}
			        <div class="alert alert-inverse block-alert">
				        <i class="icon-white icon-bullhorn"></i>
			            {% set topic_stickier = create_profile(topic.stickiedBy) %}
				
			            {{- 'topic.stickied_by' | trans({'%name%': topic_stickier.getProfilePath}, 'CCDNForumForumBundle') |raw -}}

						&nbsp;&#183;

			            {{- topic.getStickiedDate |date(ccdn_forum_forum.topic.show.topic_deleted_datetime_format) -}}
			        </div>
			    {%- endif -%}
			</div>
		</section>
	{%- endif -%}
		
	<section class="row-fluid">
	    <div class="span12 btn-toolbar">
	        <div class="span6">
	            {%- include 'CCDNForumForumBundle:Toolbar:topic_actions.html.twig' -%}
	        </div>
	        {%- if pager.haveToPaginate -%}
	            <nav class="span6 btn-right">
		            {{- pagerfanta(pager, 'twitter_bootstrap_compact', {'routeName':'ccdn_forum_forum_topic_show_paginated', 'routeParams':{'topicId':topic.getId}} ) -}}
	            </nav>
	        {%- endif -%}
	    </div>
	</section>
	
	<section>
	    {%- for key, post in pager.getCurrentPageResults -%}
	        {%- include "CCDNForumForumBundle:Post:item/post.html.twig" -%}
	    {%- endfor -%}
	</section>

	<section class="row-fluid">
	    <div class="span12 btn-toolbar">
	        <div class="span6">
	            {%- include 'CCDNForumForumBundle:Toolbar:topic_actions.html.twig' -%}
	        </div>
	        {%- if pager.haveToPaginate -%}
	            <nav class="span6 btn-right">
		            {{- pagerfanta(pager, 'twitter_bootstrap_compact', {'routeName':'ccdn_forum_forum_topic_show_paginated', 'routeParams':{'topicId':topic.getId}} ) -}}
	            </nav>
	        {%- endif -%}
	    </div>
	</section>
	
	{%- set tag_groups = BBCode_GetTagsAllowed('forum_post_body') -%}
	
	{%- include 'CCDNComponentBBCodeBundle::allowedTags.html.twig' with {'tag_groups': tag_groups} -%}
	
	{#
	<section>
		{%- for group_name, group in tag_groups -%}
			<b>
				{{- group_name -}}
			</b>
		
			<br>
			{%- for tag in group -%}
				&#91;{{- BBCode_GetTokenName(tag) -}}&#93;,&nbsp;
			{%- endfor -%}
			<br>
		{%- endfor -%}
	</section>
	#}
	
    {%- endspaceless -%}

{% endblock body_content %}
